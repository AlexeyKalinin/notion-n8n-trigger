<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>n8n Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f5f5f5; padding: 10px; }
        .log { margin: 5px 0; }
    </style>
</head>
<body>
    <h3>n8n Webhook Test</h3>
    <div id="log"></div>
    
    <script>
        const log = (msg) => {
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = new Date().toISOString().substr(11, 8) + ' - ' + msg;
            document.getElementById('log').appendChild(div);
        };
        
        const WEBHOOKS = {
            test: 'https://n8n.wefiftytwo.com/webhook-test/ats-score',
            prod: 'https://n8n.wefiftytwo.com/webhook/ats-score'
        };
        
        const params = new URLSearchParams(window.location.search);
        const mode = params.get('mode') || 'test';
        params.delete('mode');
        
        const url = WEBHOOKS[mode];
        const query = params.toString();
        
        log(`Mode: ${mode}`);
        log(`URL: ${url}`);
        log(`Params: ${query}`);
        log('---');
        
        // Test all methods
        log('Method 1: GET fetch...');
        fetch(url + '?' + query, {mode: 'no-cors'})
            .then(() => log('✓ GET fetch sent'))
            .catch(e => log('✗ GET fetch error: ' + e.message));
        
        log('Method 2: POST fetch...');
        fetch(url, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(Object.fromEntries(params))
        })
            .then(() => log('✓ POST fetch sent'))
            .catch(e => log('✗ POST fetch error: ' + e.message));
        
        log('Method 3: Image beacon...');
        const img = new Image();
        img.src = url + '?' + query;
        img.onload = () => log('✓ Image loaded');
        img.onerror = () => log('✓ Image request sent (error expected)');
        
        log('---');
        log('Check n8n webhook logs');
    </script>
</body>
</html>