<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>n8n Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f5f5f5; padding: 10px; }
        .log { margin: 5px 0; }
        .url { color: #1976D2; word-break: break-all; }
    </style>
</head>
<body>
    <h3>n8n Webhook Test</h3>
    <div id="log"></div>
    
    <script>
        const log = (msg, isUrl = false) => {
            const div = document.createElement('div');
            div.className = isUrl ? 'log url' : 'log';
            div.textContent = new Date().toISOString().substr(11, 8) + ' - ' + msg;
            document.getElementById('log').appendChild(div);
        };
        
        const WEBHOOKS = {
            test: 'https://n8n.wefiftytwo.com/webhook-test/ats-score',
            prod: 'https://n8n.wefiftytwo.com/webhook/ats-score'
        };
        
        const params = new URLSearchParams(window.location.search);
        const mode = params.get('mode') || 'test';
        params.delete('mode');
        
        const baseUrl = WEBHOOKS[mode];
        const queryString = params.toString();
        
        log(`Mode: ${mode}`);
        log(`Base URL: ${baseUrl}`);
        log(`Query String: ${queryString || '(empty)'}`);
        log('---');
        
        // Test all methods with full URLs
        const getUrl = queryString ? `${baseUrl}?${queryString}` : baseUrl;
        
        log('Method 1: GET fetch');
        log(getUrl, true);
        fetch(getUrl, {mode: 'no-cors'})
            .then(() => log('✓ GET fetch sent'))
            .catch(e => log('✗ GET fetch error: ' + e.message));
        
        setTimeout(() => {
            log('Method 2: Image beacon');
            log(getUrl, true);
            const img = new Image();
            img.src = getUrl;
            img.onload = () => log('✓ Image loaded');
            img.onerror = () => log('✓ Image request sent (error expected)');
        }, 500);
        
        setTimeout(() => {
            log('Method 3: POST fetch');
            log(`${baseUrl} with body: ${JSON.stringify(Object.fromEntries(params))}`);
            fetch(baseUrl, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(Object.fromEntries(params))
            })
                .then(() => log('✓ POST fetch sent'))
                .catch(e => log('✗ POST fetch error: ' + e.message));
        }, 1000);
        
        log('---');
        log('Check n8n webhook logs for results');
    </script>
</body>
</html>