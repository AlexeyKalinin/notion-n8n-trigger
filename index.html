<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>n8n Trigger</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f0f0f0;
        }
        pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h3>n8n Webhook Trigger</h3>
    <pre id="log"></pre>
    
    <script>
        const log = (msg, type = '') => {
            const el = document.getElementById('log');
            const span = document.createElement('span');
            span.className = type;
            span.textContent = msg + '\n';
            el.appendChild(span);
        };

        // n8n webhook URL
        const N8N_URL = 'https://n8n.wefiftytwo.com/webhook-test/810777bf-2175-4c53-b366-9cad9ac68e5c';
        
        const params = Object.fromEntries(new URLSearchParams(window.location.search));
        
        log('üìç URL: ' + N8N_URL);
        log('üì¶ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ' + JSON.stringify(params, null, 2));
        log('---');
        
        // Method 1: Try with CORS
        log('üöÄ –ü–æ–ø—ã—Ç–∫–∞ 1: –û–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å...');
        fetch(N8N_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(params)
        })
        .then(response => {
            log('‚úÖ –°—Ç–∞—Ç—É—Å: ' + response.status, 'success');
            return response.text();
        })
        .then(data => {
            log('‚úÖ –û—Ç–≤–µ—Ç: ' + (data || 'OK'), 'success');
            setTimeout(() => window.close(), 3000);
        })
        .catch(error => {
            log('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            
            // Method 2: No-CORS mode
            log('\nüöÄ –ü–æ–ø—ã—Ç–∫–∞ 2: –†–µ–∂–∏–º no-cors...');
            return fetch(N8N_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(params)
            });
        })
        .then(() => {
            log('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (no-cors mode)', 'success');
            log('\n‚ö†Ô∏è  –í —Ä–µ–∂–∏–º–µ no-cors –æ—Ç–≤–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            log('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ n8n –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è');
            
            // Method 3: Image beacon fallback
            log('\nüöÄ –ü–æ–ø—ã—Ç–∫–∞ 3: Image beacon...');
            const img = new Image();
            const urlParams = new URLSearchParams(params).toString();
            img.src = N8N_URL + '?' + urlParams;
            img.onload = () => log('‚úÖ Image beacon –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
            img.onerror = () => log('‚ö†Ô∏è  Image beacon –∑–∞–≤–µ—Ä—à–µ–Ω');
        })
        .catch(e => {
            log('‚ùå –í—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏: ' + e.message, 'error');
        });
    </script>
</body>
</html>