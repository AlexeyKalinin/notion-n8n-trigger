<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>n8n</title>
</head>
<body>
    <script>
        // Anti-cache timestamp
        const ts = Date.now();
        
        // Webhook endpoints
        const WEBHOOKS = {
            test: 'https://n8n.wefiftytwo.com/webhook-test/ats-score',
            prod: 'https://n8n.wefiftytwo.com/webhook/ats-score'
        };
        
        const params = new URLSearchParams(window.location.search);
        const mode = params.get('mode') || 'test';
        params.delete('mode');
        
        // Build URL with parameters
        const baseUrl = WEBHOOKS[mode];
        const queryString = params.toString();
        const fullUrl = queryString ? `${baseUrl}?${queryString}&_t=${ts}` : `${baseUrl}?_t=${ts}`;
        
        // Debug to console
        console.log('Sending to:', fullUrl);
        console.log('Parameters:', queryString);
        
        // Send with three methods
        // 1. GET fetch
        fetch(fullUrl, {mode: 'no-cors', cache: 'no-store'});
        
        // 2. Image beacon with full URL
        const img = new Image();
        img.src = fullUrl;
        
        // 3. POST with body
        if (queryString) {
            fetch(baseUrl + '?_t=' + ts, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(Object.fromEntries(params))
            });
        }
        
        // Close window faster
        setTimeout(() => {
            window.close();
            window.history.back();
        }, 50);
    </script>
</body>
</html>